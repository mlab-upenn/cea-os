version: "3.9"
services: 
    cea-os:
        build: . #builds image from Dockerfile in current directory
        container_name: cea_os

    influxdb:
        image: influxdb:1.8
        ports:
            - 8086:8086 #influxdb port
        #### Optional items: ####
        container_name: influxdb
        restart: always #if something happpens in container, it can start automatically
        networks:
            - grafana_network #make sure the same as grafana container
        volumes: #do we want persistent volumes?
            #- influxdb_data:/var/lib/influxdb #create Docker volume called "influxdb_data"
            #- $PWD/docker_data/influxdb_data:/var/lib/influxdb
            - type: bind
              source: ./docker_data/influxdb_data
              target: /var/lib/influxdb
        environment:
            - INFLUXDB_DB=grafana #creates a database when we create container
            - INFLUXDB_USER=grafana #creates a user called "grafana"
            - INFLUXDB_USER_PASSWORD=password
            - INFLUXDB_ADMIN_ENABLED=true
            - INFLUXDB_ADMIN_USER=admin
            - INFLUXDB_ADMIN_PASSWORD=password
    
    grafana: 
        image: grafana/grafana
        user: root #needed for bind mount
        ports:
            - 3000:3000 #grafana port
        #### Optional items: ####
        container_name: grafana
        restart: always
        networks: 
            - grafana_network #use for influxdb, same network
        volumes: #do we want persistent volumes?
            #- grafana_data:/var/lib/grafana #create Docker volume called "grafana_data"
            #- $PWD/docker_data/grafana_data:/var/lib/grafana
            - type: bind
              source: ./docker_data/grafana_data
              target: /var/lib/grafana
        depends_on:
            - influxdb

networks:
    grafana_network:
# volumes:
#     grafana_data:
#     influxdb_data:

